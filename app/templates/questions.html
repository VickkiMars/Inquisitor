{# templates/questions.html #}
{% extends "base.html" %}

{% block title %}{{ topic_data.topic }} Questions - Inquisitor{% endblock %}

{% block content %}
    <div class="flex flex-wrap justify-between gap-3 p-4 relative"> {# Added relative positioning #}
        <div class="flex min-w-72 flex-col gap-3">
            <p class="text-[#111418] tracking-light text-[32px] font-bold leading-tight">{{ topic_data.topic }}</p>
            <p class="text-[#60758a] text-sm font-normal leading-normal">
                These are questions generated by The Inquisitor. You can view answers and explanations.
            </p>
        </div>
        {# Export as JSON button - positioned at top right #}
        <div class="absolute top-4 right-4"> {# Absolute positioning for top right #}
            <button id="exportJsonBtn"
                class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-white text-black text-sm font-bold leading-normal tracking-[0.015em] border border-black
                       hover:bg-gray-100 hover:shadow-md transition-colors transition-shadow duration-300 ease-in-out"
            >
                <span class="truncate">Export as JSON</span>
            </button>
        </div>
    </div>

    <div class="flex overflow-x-auto snap-x snap-mandatory pb-4 hide-scrollbar">
        {% for question in topic_data.questions %}
            <div class="question-item flex-none w-11/12 md:w-2/3 lg:w-1/2 xl:w-1/3 2xl:w-1/4 max-w-lg mx-2 bg-white px-4 py-3 border border-[#dee2e6] rounded-lg shadow-sm snap-center">
                <h3 class="text-[#111418] text-lg font-bold leading-tight tracking-[-0.015em] mb-2">
                    Question {{ loop.index }}
                </h3>

                <div class="question-content text-[#111418] text-base font-medium leading-normal mb-3">
                    {{ question.question }}
                </div>

                {# Dynamically include the template for each question type #}
                {% if question.type == 'multiple_choice' %}
                    {% with question=question, index=loop.index %}
                        {% include 'components/multiple_choice.html' %}
                    {% endwith %}
                {% elif question.type == 'short_answer' %}
                    {% include 'components/short_answer.html' %}
                {% elif question.type == 'long_answer' %}
                    {% include 'components/long_answer.html' %}
                {% elif question.type == 'solve_problem' %}
                    {% include 'components/solve_problem.html' %}
                {% elif question.type == 'fill_in_the_blank' %}
                    {% include 'components/fill_in_the_blank.html' %}
                {% elif question.type == 'use_case' %}
                    {% include 'components/use_case.html' %}
                {% elif question.type == 'matching' %}
                    {% include 'components/matching.html' %}
                {% elif question.type == 'true_false' %}
                    {% include 'components/true_false.html' %}
                {% elif question.type == 'reverse_definition' %}
                    {% include 'components/reverse_definition.html' %}
                {% else %}
                    <p class="text-red-500">Unknown question type: {{ question.type }}</p>
                {% endif %}

                {# Common "Show Answer" button and Answer/Explanation sections #}
                <div class="mt-4 pt-4 border-t border-dashed border-[#dee2e6] answer-controls">
                    <button class="show-answer-btn bg-[#28a745] hover:bg-[#218838] text-white px-4 py-2 rounded-lg text-sm font-bold">
                        Show Answer & Explanation
                    </button>

                    <div class="answer-section hidden mt-3 text-[#343a40]">
                        <p class="font-bold">Answer: <span class="font-normal">{{ question.answer }}</span></p>
                    </div>
                    <div class="explanation-section hidden mt-2 text-[#6c757d] text-sm italic">
                        <p>Explanation: {{ question.explanation }}</p>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>

    <div class="flex justify-stretch mb-8">
        <div class="flex flex-1 gap-3 flex-wrap px-4 py-3 justify-end">
            <a href="/generate">
                <button
                    class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-[#f0f2f5] text-[#111418] text-sm font-bold leading-normal tracking-[0.015em]"
                >
                    <span class="truncate">Regenerate Questions</span>
                </button>
            </a>
            <button
                class="relative flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-[#0c7ff2] text-white text-sm font-bold leading-normal tracking-[0.015em]"
            >
                <span class="truncate">Save Questions</span>
                <div
                    class="absolute top-0 right-0 -mt-2 -mr-2 bg-yellow-400 text-gray-800 text-xs font-semibold px-2 py-0.5 rounded-full shadow-md transform rotate-12"
                >
                    Coming Soon
                </div>
            </button>
        </div>
    </div>
{% endblock %}

{% block scripts_extra %}
<script>
    // JavaScript to toggle answers and explanations
    document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('.show-answer-btn').forEach(button => {
            button.addEventListener('click', function() {
                const questionItem = this.closest('.question-item');
                const answerSection = questionItem.querySelector('.answer-section');
                const explanationSection = questionItem.querySelector('.explanation-section');

                answerSection.classList.toggle('hidden');
                explanationSection.classList.toggle('hidden');

                if (answerSection.classList.contains('hidden')) {
                    this.textContent = 'Show Answer & Explanation';
                } else {
                    this.textContent = 'Hide Answer & Explanation';
                }
            });
        });

        // JavaScript for "Export as JSON" button
        document.getElementById('exportJsonBtn').addEventListener('click', function() {
            // Assuming topic_data is available in the Jinja2 context and contains the questions
            const dataToExport = {{ topic_data | tojson }};

            const filename = `${dataToExport.topic.toLowerCase().replace(/\s+/g, '-')}-questions.json`;
            const jsonString = JSON.stringify(dataToExport, null, 2); // null, 2 for pretty-printing

            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);

            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });
    });
</script>

<style>
    /* Custom CSS to hide scrollbar while keeping scroll functionality */
    .hide-scrollbar {
        -ms-overflow-style: none;  /* IE and Edge */
        scrollbar-width: none;  /* Firefox */
    }
    .hide-scrollbar::-webkit-scrollbar {
        display: none;  /* Chrome, Safari, Opera */
    }
</style>
{% endblock %}